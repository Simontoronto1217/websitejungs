<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHRONEXT Escalation Cockpit</title>
    
    <!-- Tailwind CSS für das Styling (Chronext Look) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React und ReactDOM (Die Engine) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel (Damit der Browser React versteht) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts: Inter (Ähnlich wie Chronext CI) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111111; /* Deep Black Background */
            color: #f3f4f6;
        }
        .cx-green { color: #00A651; }
        .bg-cx-green { background-color: #00A651; }
        .bg-cx-green:hover { background-color: #008c44; }
        
        .card-dark {
            background-color: #1a1a1a;
            border: 1px solid #333;
        }
        
        /* Scrollbar dunkel machen */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #111; 
        }
        ::-webkit-scrollbar-thumb {
            background: #444; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- ICONS (Als SVG Komponenten, damit keine externen Imports nötig sind) ---
        const ShieldAlert = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
        );
        const Plus = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M5 12h14"/><path d="M12 5v14"/></svg>
        );
        const Trash2 = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        );
        const Clock = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        );
        const Copy = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>
        );
        const CheckCircle = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );
        const Save = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        );

        // --- HAUPTAPP ---
        const EscalationManager = () => {
            // DATEN LADEN: Versucht beim Start Daten aus dem LocalStorage zu holen
            const [cases, setCases] = React.useState(() => {
                try {
                    const savedData = localStorage.getItem('cx_escalation_data_v1');
                    return savedData ? JSON.parse(savedData) : [];
                } catch (error) {
                    console.error("Fehler beim Laden der Daten:", error);
                    return [];
                }
            });

            const [formData, setFormData] = React.useState({
                name: '',
                caseNumber: '',
                type: 'Refund (Storno)',
                priority: 'Normal',
                waitingSince: '',
                context: ''
            });

            // DATEN SPEICHERN: Speichert automatisch bei jeder Änderung an 'cases'
            React.useEffect(() => {
                localStorage.setItem('cx_escalation_data_v1', JSON.stringify(cases));
            }, [cases]);

            // Prioritäten-Logik
            const priorityScore = (p) => {
                switch (p) {
                    case 'Rechtliche Schritte/Einschreiben': return 5;
                    case 'Anwalt gedroht': return 4;
                    case 'Trustpilot Gefahr': return 3;
                    case 'Unruhig': return 2;
                    default: return 1;
                }
            };

            // Automatische Sortierung
            const sortedCases = React.useMemo(() => {
                return [...cases].sort((a, b) => {
                    const scoreA = priorityScore(a.priority);
                    const scoreB = priorityScore(b.priority);
                    if (scoreB !== scoreA) return scoreB - scoreA;
                    
                    // Bei gleicher Prio: Wer wartet länger?
                    const dateA = a.waitingSince ? new Date(a.waitingSince).getTime() : 0;
                    const dateB = b.waitingSince ? new Date(b.waitingSince).getTime() : 0;
                    return dateA - dateB;
                });
            }, [cases]);

            const handleAdd = () => {
                if (!formData.name || !formData.caseNumber) return;
                const newCase = {
                    ...formData,
                    id: Date.now().toString(),
                    dateAdded: new Date().toLocaleDateString('de-DE')
                };
                setCases([...cases, newCase]);
                // Formular zurücksetzen, Datum behalten
                setFormData({ ...formData, name: '', caseNumber: '', context: '' });
            };

            const handleDelete = (id) => {
                if(confirm('Diesen Fall wirklich löschen?')) {
                    setCases(cases.filter(c => c.id !== id));
                }
            };

            const generateEmailText = () => {
                const urgentCases = sortedCases.filter(c => priorityScore(c.priority) >= 3);
                const date = new Date().toLocaleDateString('de-DE');

                let text = `Betreff: DRINGEND: Eskalations-Liste Auszahlungen - ${date}\n\n`;
                text += `Hallo [Name],\n\n`;
                text += `Hier ist die Übersicht der kritischen Fälle von heute. Um Trustpilot-Schäden und Rechtskosten abzuwenden, bitte ich um priorisierte Freigabe für folgende Fälle:\n\n`;

                if (urgentCases.length === 0) {
                    text += "(Keine kritischen Prio-3+ Fälle heute erfasst)\n\n";
                }

                urgentCases.forEach((c, index) => {
                    text += `${index + 1}. ${c.priority.toUpperCase()} - ${c.name} (Fall #${c.caseNumber})\n`;
                    text += `   - Typ: ${c.type}\n`;
                    text += `   - Wartet seit: ${c.waitingSince || 'Nicht angegeben'}\n`;
                    text += `   - Kontext: ${c.context}\n\n`;
                });

                text += `Gesamtübersicht aller offenen Eskalationen im Anhang.\n\nBeste Grüße,\n[Dein Name]`;
                return text;
            };

            const copyToClipboard = () => {
                const text = generateEmailText();
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert("E-Mail Text kopiert!");
            };

            // Farb-Logik für Dark Mode
            const getPriorityColor = (p) => {
                switch (p) {
                    case 'Rechtliche Schritte/Einschreiben': return 'border-l-4 border-red-600 bg-red-900/20';
                    case 'Anwalt gedroht': return 'border-l-4 border-orange-500 bg-orange-900/20';
                    case 'Trustpilot Gefahr': return 'border-l-4 border-yellow-500 bg-yellow-900/20';
                    default: return 'border border-gray-700 bg-gray-800';
                }
            };
            
            const getBadgeColor = (p) => {
                 switch (p) {
                    case 'Rechtliche Schritte/Einschreiben': return 'text-red-400 border-red-900 bg-red-900/30';
                    case 'Anwalt gedroht': return 'text-orange-400 border-orange-900 bg-orange-900/30';
                    case 'Trustpilot Gefahr': return 'text-yellow-400 border-yellow-900 bg-yellow-900/30';
                    default: return 'text-gray-400 border-gray-700 bg-gray-800';
                }
            }

            return (
                <div className="min-h-screen p-4 md:p-8">
                    <div className="max-w-6xl mx-auto">
                        
                        {/* Header */}
                        <div className="mb-10 flex items-center justify-between border-b border-gray-800 pb-6">
                            <div className="flex items-center gap-3">
                                <ShieldAlert className="w-10 h-10 text-white" />
                                <div>
                                    <h1 className="text-2xl font-light tracking-wide text-white">CHRONEXT <span className="font-bold text-gray-500">INTERNAL</span></h1>
                                    <p className="text-gray-400 text-sm">Escalation Management Cockpit v2.1</p>
                                </div>
                            </div>
                            {/* Auto-Save Indicator */}
                            <div className="hidden md:flex flex-col items-end">
                                <span className="text-xs text-green-500 flex items-center gap-1 border border-green-900 bg-green-900/10 px-3 py-1 rounded-full mb-1">
                                    <Save className="w-3 h-3" /> Auto-Save aktiv (Lokal)
                                </span>
                                <span className="text-[10px] text-gray-600">Daten werden im Browser-Cache gespeichert.</span>
                            </div>
                        </div>

                        {/* Eingabe Bereich */}
                        <div className="card-dark p-6 rounded-lg shadow-xl mb-8">
                            <h2 className="text-lg font-medium mb-6 flex items-center gap-2 text-white">
                                <span className="bg-cx-green w-1 h-6 rounded-sm"></span>
                                Neuen Fall erfassen
                            </h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
                                <input
                                    className="p-3 bg-black border border-gray-700 rounded text-white focus:border-green-600 outline-none transition-colors"
                                    placeholder="Kundenname"
                                    value={formData.name}
                                    onChange={e => setFormData({...formData, name: e.target.value})}
                                />
                                <input
                                    className="p-3 bg-black border border-gray-700 rounded text-white focus:border-green-600 outline-none transition-colors"
                                    placeholder="Fall Nummer / Order ID"
                                    value={formData.caseNumber}
                                    onChange={e => setFormData({...formData, caseNumber: e.target.value})}
                                />
                                <select
                                    className="p-3 bg-black border border-gray-700 rounded text-white focus:border-green-600 outline-none"
                                    value={formData.type}
                                    onChange={e => setFormData({...formData, type: e.target.value})}
                                >
                                    <option>Refund (Storno)</option>
                                    <option>Auszahlung (Verkauf)</option>
                                </select>
                                
                                <select
                                    className="p-3 bg-black border border-gray-700 rounded text-white focus:border-red-500 outline-none"
                                    value={formData.priority}
                                    onChange={e => setFormData({...formData, priority: e.target.value})}
                                >
                                    <option>Normal</option>
                                    <option>Unruhig</option>
                                    <option>Trustpilot Gefahr</option>
                                    <option>Anwalt gedroht</option>
                                    <option>Rechtliche Schritte/Einschreiben</option>
                                </select>

                                <div className="flex flex-col">
                                    <label className="text-xs text-gray-500 mb-1 ml-1">Wartet auf Geld seit:</label>
                                    <input
                                        type="date"
                                        className="p-2.5 bg-black border border-gray-700 rounded text-white focus:border-green-600 outline-none w-full"
                                        value={formData.waitingSince}
                                        onChange={e => setFormData({...formData, waitingSince: e.target.value})}
                                    />
                                </div>

                                <input
                                    className="p-3 bg-black border border-gray-700 rounded text-white focus:border-green-600 outline-none lg:col-span-1"
                                    placeholder="Kontext (Kurzfassung für Chef)"
                                    value={formData.context}
                                    onChange={e => setFormData({...formData, context: e.target.value})}
                                />
                            </div>
                            
                            <button
                                onClick={handleAdd}
                                className="mt-6 bg-cx-green hover:bg-green-700 text-white px-8 py-3 rounded font-medium transition-all w-full md:w-auto flex justify-center items-center gap-2 uppercase tracking-wider text-sm shadow-lg hover:shadow-green-900/50"
                            >
                                <Plus className="w-4 h-4" /> Fall hinzufügen
                            </button>
                        </div>

                        {/* Dashboard Grid */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            
                            {/* Linke Spalte: Die Liste */}
                            <div className="lg:col-span-2 space-y-4">
                                <div className="flex justify-between items-center pb-2 border-b border-gray-800">
                                    <h2 className="text-gray-300 font-medium">Priorisierte Liste</h2>
                                    <span className="text-xs bg-gray-800 px-2 py-1 rounded text-gray-400">{sortedCases.length} Fälle</span>
                                </div>

                                {sortedCases.length === 0 && (
                                    <div className="text-center py-16 border border-dashed border-gray-800 rounded-lg text-gray-600">
                                        <ShieldAlert className="w-12 h-12 mx-auto mb-3 opacity-20" />
                                        <p>Warteraum leer. Bereit für Eingaben.</p>
                                    </div>
                                )}

                                {sortedCases.map(c => (
                                    <div key={c.id} className={`p-4 rounded shadow-sm flex flex-col md:flex-row gap-4 justify-between items-start md:items-center transition-all ${getPriorityColor(c.priority)}`}>
                                        <div className="flex-1">
                                            <div className="flex flex-wrap items-center gap-2 mb-2">
                                                <span className={`text-[10px] uppercase tracking-wider font-bold px-2 py-0.5 rounded border ${getBadgeColor(c.priority)}`}>
                                                    {c.priority}
                                                </span>
                                                <span className="text-xs text-gray-500 flex items-center gap-1">
                                                    <Clock className="w-3 h-3" /> Seit: {c.waitingSince || 'N/A'}
                                                </span>
                                                <span className="text-xs text-gray-500 bg-gray-900 px-2 py-0.5 rounded">
                                                    {c.type}
                                                </span>
                                            </div>
                                            <h3 className="font-bold text-white text-lg">{c.name} <span className="text-gray-600 font-normal text-sm">#{c.caseNumber}</span></h3>
                                            <p className="text-sm text-gray-400 mt-1">{c.context}</p>
                                        </div>
                                        <button onClick={() => handleDelete(c.id)} className="text-gray-600 hover:text-red-500 transition-colors p-2 hover:bg-gray-900 rounded-full">
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    </div>
                                ))}
                            </div>

                            {/* Rechte Spalte: Email Generator */}
                            <div className="lg:col-span-1">
                                <div className="sticky top-6">
                                    <div className="card-dark rounded-lg p-5 border border-gray-700">
                                        <h2 className="text-gray-300 font-medium mb-4 flex items-center gap-2">
                                            <CheckCircle className="w-5 h-5 text-green-500" /> Tagesabschluss
                                        </h2>
                                        
                                        <div className="bg-black text-gray-300 p-4 rounded text-xs font-mono whitespace-pre-wrap shadow-inner border border-gray-800 h-[400px] overflow-y-auto">
                                            {generateEmailText()}
                                        </div>
                                        
                                        <button
                                            onClick={copyToClipboard}
                                            className="mt-4 w-full bg-white text-black hover:bg-gray-200 py-3 rounded font-medium shadow-lg flex justify-center items-center gap-2 transition-transform active:scale-95 uppercase text-xs tracking-widest"
                                        >
                                            <Copy className="w-4 h-4" /> Für Mail kopieren
                                        </button>
                                    </div>
                                    <div className="mt-4 text-center">
                                         <p className="text-xs text-gray-600 italic">"Stay focused. You got this." - Anna</p>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<EscalationManager />);
    </script>
</body>
</html>
