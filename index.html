<!DOCTYPE html>
<html lang="de" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHRONEXT Intervention Command Center</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/@alpinejs/collapse@3.13.3/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chronext': {
                            'dark': '#0a0a0f',
                            'anthracite': '#1a1a24',
                            'navy': '#0d1b2a',
                            'platinum': '#e5e4e2',
                            'rosegold': '#b76e79',
                            'crimson': '#8b0000',
                            'gold': '#d4af37',
                        }
                    },
                    fontFamily: {
                        'cinzel': ['Cinzel', 'serif'],
                        'inter': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0f;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            color: #e5e4e2;
        }

        /* Sisyphus Hero Section */
        #sisyphus-hero {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: 1;
            pointer-events: none;
        }

        #sisyphus-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            filter: grayscale(0.5) sepia(0.2);
            mix-blend-mode: luminosity;
        }

        #sisyphus-boulder {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #8b8680, #4a4540);
            box-shadow: 
                inset -10px -10px 30px rgba(0,0,0,0.5),
                0 20px 60px rgba(0,0,0,0.8);
            bottom: 10%;
            right: 20%;
            will-change: transform;
        }

        #sisyphus-figure {
            position: absolute;
            width: 80px;
            height: 80px;
            bottom: 10%;
            right: 25%;
            opacity: 0.9;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.8));
            will-change: transform;
        }

        /* Glassmorphism */
        .glassmorphism {
            background: rgba(26, 26, 36, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(229, 228, 226, 0.1);
        }

        .glassmorphism-light {
            background: rgba(229, 228, 226, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(229, 228, 226, 0.08);
        }

        .text-gradient-gold {
            background: linear-gradient(135deg, #d4af37 0%, #f4e5c3 50%, #d4af37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Pulse Animations */
        .pulse-critical {
            animation: pulse-crimson 2s infinite;
        }

        @keyframes pulse-crimson {
            0%, 100% { box-shadow: 0 0 0 0 rgba(139, 0, 0, 0.4); }
            50% { box-shadow: 0 0 20px 10px rgba(139, 0, 0, 0.2); }
        }

        .pulse-warning {
            animation: pulse-rosegold 2.5s infinite;
        }

        @keyframes pulse-rosegold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(183, 110, 121, 0.3); }
            50% { box-shadow: 0 0 15px 5px rgba(183, 110, 121, 0.15); }
        }

        /* Magnetic Button */
        .magnetic-btn {
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
        }

        .magnetic-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 40px rgba(212, 175, 55, 0.15);
        }

        /* Ticket Card */
        .ticket-card {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-style: preserve-3d;
        }

        .ticket-card:hover {
            transform: translateY(-8px) rotateX(2deg);
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.5);
        }

        /* Physics Canvas */
        #physics-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        /* Scroll Progress */
        #scroll-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background: linear-gradient(90deg, #d4af37, #b76e79, #e5e4e2);
            z-index: 9999;
            transition: width 0.1s ease-out;
        }

        /* Category Badge */
        .category-badge {
            font-size: 0.65rem;
            letter-spacing: 0.1em;
        }

        /* Watch Tick */
        @keyframes watchTick {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(6deg); }
            75% { transform: rotate(-6deg); }
        }

        .watch-tick {
            animation: watchTick 0.8s ease-in-out;
        }

        /* Truck Animation */
        @keyframes truckDrive {
            0% { transform: translateX(-100vw) scale(1); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(200vw) scale(0.8); opacity: 0; }
        }

        .truck-animation {
            position: fixed;
            bottom: 20%;
            left: 0;
            font-size: 4rem;
            z-index: 9999;
            animation: truckDrive 4s ease-in-out forwards;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.5));
        }

        /* Legal Gavel */
        @keyframes gavelStrike {
            0%, 100% { transform: rotate(0deg) translateY(0); }
            25% { transform: rotate(-30deg) translateY(-20px); }
            50% { transform: rotate(0deg) translateY(0); }
            75% { transform: rotate(-20deg) translateY(-10px); }
        }

        .gavel-animation {
            position: fixed;
            top: 30%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 5rem;
            z-index: 9999;
            animation: gavelStrike 1s ease-in-out;
            filter: drop-shadow(0 20px 40px rgba(139, 0, 0, 0.6));
        }

        /* Finance Coins */
        @keyframes coinDrop {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(1080deg); opacity: 0; }
        }

        .coin-animation {
            position: fixed;
            font-size: 3rem;
            z-index: 9999;
            animation: coinDrop 3s ease-in forwards;
            filter: drop-shadow(0 10px 30px rgba(212, 175, 55, 0.6));
        }

        /* Update Message */
        @keyframes messageFloat {
            0% { transform: translateY(100vh) scale(0.5) rotate(-10deg); opacity: 0; }
            50% { transform: translateY(50vh) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-100vh) scale(0.5) rotate(10deg); opacity: 0; }
        }

        .message-animation {
            position: fixed;
            font-size: 4rem;
            z-index: 9999;
            animation: messageFloat 3s ease-in-out forwards;
            filter: drop-shadow(0 10px 30px rgba(229, 228, 226, 0.4));
        }

        /* Confetti */
        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 9998;
            animation: confettiFall 3s ease-in forwards;
        }

        /* Good to Know Popup */
        .good-to-know-popup {
            animation: popupBounce 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popupBounce {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(10deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        /* Sisyphus Anger */
        @keyframes angerShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        .anger-shake {
            animation: angerShake 0.5s ease-in-out;
        }

        /* Boulder Rollback */
        @keyframes boulderRollback {
            0% { transform: translateY(0) rotate(0deg) scale(1); }
            50% { transform: translateY(-100px) rotate(180deg) scale(1.2); }
            100% { transform: translateY(150vh) rotate(1080deg) scale(0.5); }
        }

        .boulder-rollback {
            animation: boulderRollback 3s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        /* Ticket Shatter */
        @keyframes ticketShatter {
            0% { opacity: 1; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.5; transform: scale(1.1) rotate(5deg); }
            100% { opacity: 0; transform: scale(0.3) rotate(25deg) translateY(100px); }
        }

        .ticket-shatter {
            animation: ticketShatter 1s ease-out forwards;
        }

        /* Scrollbar */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Content Layer */
        .content-layer {
            position: relative;
            z-index: 10;
        }

        /* Parallax Layers */
        .parallax-slow {
            will-change: transform;
        }

        .parallax-medium {
            will-change: transform;
        }

        .parallax-fast {
            will-change: transform;
        }

        /* Hero Spacer */
        .hero-spacer {
            height: 100vh;
            position: relative;
            z-index: 5;
        }

        /* Fade In */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body x-data="interventionDashboard()" x-init="init()">

    <!-- Scroll Progress Bar -->
    <div id="scroll-progress"></div>

    <!-- Physics Canvas -->
    <canvas id="physics-canvas"></canvas>

    <!-- Sisyphus Hero Background -->
    <div id="sisyphus-hero">
        <img id="sisyphus-image" src="https://cdn.abacus.ai/images/e8337be4-7776-431c-8d96-8c2334bcbc7f.png" alt="Sisyphus">
        <div id="sisyphus-boulder"></div>
        <svg id="sisyphus-figure" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <!-- Simplified Sisyphus Figure -->
            <ellipse cx="50" cy="30" rx="12" ry="15" fill="#8b8680" opacity="0.9"/>
            <rect x="44" y="40" width="12" height="30" rx="6" fill="#8b8680" opacity="0.9"/>
            <line x1="50" y1="45" x2="35" y2="35" stroke="#8b8680" stroke-width="4" stroke-linecap="round" opacity="0.9"/>
            <line x1="50" y1="45" x2="65" y2="55" stroke="#8b8680" stroke-width="4" stroke-linecap="round" opacity="0.9"/>
            <line x1="44" y1="70" x2="35" y2="90" stroke="#8b8680" stroke-width="4" stroke-linecap="round" opacity="0.9"/>
            <line x1="56" y1="70" x2="65" y2="90" stroke="#8b8680" stroke-width="4" stroke-linecap="round" opacity="0.9"/>
        </svg>
    </div>

    <!-- Hero Spacer -->
    <div class="hero-spacer flex items-center justify-center">
        <div class="text-center px-6 parallax-medium">
            <h1 class="font-cinzel text-5xl md:text-7xl font-bold mb-4 text-gradient-gold">
                INTERVENTION CENTER
            </h1>
            <p class="text-xl md:text-2xl text-chronext-platinum/70 mb-8">
                Sisyphus' Aufstieg zur Perfektion
            </p>
            <div class="flex items-center justify-center gap-4">
                <div class="glassmorphism rounded-full px-6 py-3">
                    <span class="text-sm text-chronext-platinum/60 uppercase tracking-wider">Active Tickets</span>
                    <span class="ml-3 font-cinzel text-3xl font-bold text-chronext-gold" x-text="activeTickets.length"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Layer -->
    <div class="content-layer" x-cloak>

        <!-- Header -->
        <header class="sticky top-0 z-50 glassmorphism">
            <div class="max-w-7xl mx-auto px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div @click="triggerGoodToKnow()" class="w-10 h-10 rounded-full bg-gradient-to-br from-chronext-gold to-chronext-rosegold flex items-center justify-center cursor-pointer hover:scale-110 transition-transform" id="watch-logo">
                            <i data-lucide="watch" class="w-5 h-5 text-chronext-dark"></i>
                        </div>
                        <div>
                            <h2 class="font-cinzel text-lg font-semibold tracking-wide text-gradient-gold">CHRONEXT</h2>
                            <p class="text-xs text-chronext-platinum/50">Escalation Management</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3">
                        <button @click="syncData()" class="magnetic-btn glassmorphism-light rounded-lg px-4 py-2 flex items-center gap-2 hover:bg-chronext-gold/10">
                            <i data-lucide="refresh-cw" class="w-4 h-4" :class="syncing ? 'animate-spin' : ''"></i>
                            <span class="text-sm" x-text="syncing ? 'Syncing...' : 'Sync'"></span>
                        </button>

                        <button @click="showInputModal = true" class="magnetic-btn bg-gradient-to-r from-chronext-gold to-chronext-rosegold text-chronext-dark rounded-lg px-5 py-2 font-semibold text-sm flex items-center gap-2">
                            <i data-lucide="plus" class="w-4 h-4"></i>
                            Parse Input
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sisyphus Progress Section -->
        <div class="max-w-7xl mx-auto px-6 py-8 fade-in">
            <div class="glassmorphism rounded-2xl p-8 relative overflow-hidden">
                <div class="absolute inset-0 opacity-5 pointer-events-none">
                    <svg viewBox="0 0 800 200" class="w-full h-full">
                        <path d="M0,200 L0,120 L200,80 L400,40 L600,80 L800,120 L800,200 Z" fill="currentColor"/>
                    </svg>
                </div>

                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <i data-lucide="mountain" class="w-6 h-6 text-chronext-gold"></i>
                            <span class="text-lg font-cinzel font-semibold text-chronext-platinum uppercase tracking-wider">Sisyphus' Aufstieg</span>
                            <button @click="checkSisyphusPatience()" class="text-xs text-chronext-gold/50 hover:text-chronext-gold transition-colors ml-2">
                                (Wie geht's ihm?)
                            </button>
                        </div>
                        <div class="flex items-center gap-3">
                            <span class="text-sm text-chronext-platinum/40" x-text="activeTickets.length + ' verbleibend'"></span>
                            <span class="font-cinzel text-2xl text-chronext-gold" x-text="Math.round(sisyphusProgress) + '%'"></span>
                        </div>
                    </div>

                    <div class="h-4 bg-chronext-dark rounded-full overflow-hidden relative mb-3">
                        <div class="h-full bg-gradient-to-r from-chronext-gold via-chronext-rosegold to-chronext-platinum rounded-full transition-all duration-1000 ease-out relative" :style="'width: ' + sisyphusProgress + '%'">
                            <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                        </div>
                    </div>

                    <div class="text-center">
                        <p class="text-sm text-chronext-gold/70 italic font-cinzel" x-text="getMotivationalQuote()"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Critical Tickets -->
        <template x-if="criticalTickets.length > 0">
            <div class="max-w-7xl mx-auto px-6 py-6 fade-in">
                <div class="mb-6 flex items-center gap-3">
                    <i data-lucide="alert-triangle" class="w-6 h-6 text-chronext-crimson"></i>
                    <h3 class="font-cinzel text-2xl tracking-wider text-chronext-crimson uppercase">Kritische Eskalationen</h3>
                </div>
                <div class="grid gap-6">
                    <template x-for="ticket in criticalTickets" :key="ticket.id">
                        <div class="ticket-card glassmorphism rounded-2xl p-6 pulse-critical border-l-4 border-chronext-crimson" x-data="{expanded: false}" :data-ticket-id="ticket.id">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center gap-3 mb-3">
                                        <span class="category-badge px-3 py-1 rounded-lg bg-chronext-crimson/20 text-chronext-crimson uppercase font-bold" x-text="ticket.category"></span>
                                        <span class="category-badge px-3 py-1 rounded-lg bg-chronext-gold/20 text-chronext-gold uppercase font-bold" x-text="'Prio ' + ticket.priority"></span>
                                        <span class="text-xs text-chronext-platinum/40" x-text="formatTimestamp(ticket.timestamp)"></span>
                                    </div>
                                    <h4 class="font-cinzel text-xl mb-2" x-text="ticket.clientName || 'Unbekannter Kunde'"></h4>
                                    <p class="text-sm text-chronext-platinum/80 mb-4" x-text="ticket.problem"></p>

                                    <div x-show="expanded" x-collapse class="mt-4 pt-4 border-t border-chronext-platinum/10">
                                        <template x-if="ticket.context">
                                            <p class="text-xs text-chronext-platinum/60 mb-3" x-text="ticket.context"></p>
                                        </template>
                                        <template x-if="ticket.phone">
                                            <div class="flex items-center gap-2 mb-2 cursor-pointer hover:text-chronext-gold transition-colors" @click="copyToClipboard(ticket.phone)">
                                                <i data-lucide="phone" class="w-4 h-4 text-chronext-gold"></i>
                                                <span class="text-sm" x-text="ticket.phone"></span>
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                <div class="flex items-center gap-2 ml-4">
                                    <template x-for="link in ticket.links" :key="link">
                                        <a :href="link" target="_blank" class="magnetic-btn glassmorphism-light rounded-lg px-3 py-2 text-xs hover:bg-chronext-gold/10 flex items-center gap-1">
                                            <i data-lucide="external-link" class="w-3 h-3"></i>
                                            <span x-text="getLinkLabel(link)"></span>
                                        </a>
                                    </template>
                                </div>
                            </div>

                            <div class="flex items-center justify-between mt-4 pt-4 border-t border-chronext-platinum/10">
                                <button @click="expanded = !expanded" class="text-xs text-chronext-platinum/50 hover:text-chronext-gold transition-colors flex items-center gap-1">
                                    <i data-lucide="chevron-down" class="w-4 h-4 transition-transform" :class="expanded ? 'rotate-180' : ''"></i>
                                    <span x-text="expanded ? 'Weniger' : 'Details'"></span>
                                </button>

                                <div class="flex items-center gap-2">
                                    <button @click="editTicket(ticket)" class="magnetic-btn glassmorphism-light rounded-lg px-3 py-2 text-xs hover:bg-chronext-platinum/10">
                                        <i data-lucide="edit-2" class="w-4 h-4"></i>
                                    </button>
                                    <button @click="dismissTicket(ticket.id, ticket.category)" class="magnetic-btn bg-green-500/20 text-green-400 rounded-lg px-5 py-2 text-sm font-semibold hover:bg-green-500/30">
                                        Erledigt
                                    </button>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </template>

        <!-- Category Filters -->
        <div class="max-w-7xl mx-auto px-6 py-6 fade-in">
            <div class="flex items-center gap-3 overflow-x-auto scrollbar-hide pb-2">
                <button @click="activeFilter = 'all'" class="magnetic-btn whitespace-nowrap px-5 py-3 rounded-xl text-sm transition-all font-semibold" :class="activeFilter === 'all' ? 'bg-chronext-gold text-chronext-dark' : 'glassmorphism-light hover:bg-chronext-gold/10'">
                    Alle (<span x-text="activeTickets.length"></span>)
                </button>
                <button @click="activeFilter = 'finance'" class="magnetic-btn whitespace-nowrap px-5 py-3 rounded-xl text-sm transition-all flex items-center gap-2 font-semibold" :class="activeFilter === 'finance' ? 'bg-chronext-gold text-chronext-dark' : 'glassmorphism-light hover:bg-chronext-gold/10'">
                    <i data-lucide="banknote" class="w-4 h-4"></i>
                    Finance (<span x-text="getTicketsByCategory('finance').length"></span>)
                </button>
                <button @click="activeFilter = 'legal'" class="magnetic-btn whitespace-nowrap px-5 py-3 rounded-xl text-sm transition-all flex items-center gap-2 font-semibold" :class="activeFilter === 'legal' ? 'bg-chronext-crimson text-white' : 'glassmorphism-light hover:bg-chronext-crimson/10'">
                    <i data-lucide="scale" class="w-4 h-4"></i>
                    Legal (<span x-text="getTicketsByCategory('legal').length"></span>)
                </button>
                <button @click="activeFilter = 'logistics'" class="magnetic-btn whitespace-nowrap px-5 py-3 rounded-xl text-sm transition-all flex items-center gap-2 font-semibold" :class="activeFilter === 'logistics' ? 'bg-chronext-gold text-chronext-dark' : 'glassmorphism-light hover:bg-chronext-gold/10'">
                    <i data-lucide="truck" class="w-4 h-4"></i>
                    Logistics (<span x-text="getTicketsByCategory('logistics').length"></span>)
                </button>
                <button @click="activeFilter = 'update'" class="magnetic-btn whitespace-nowrap px-5 py-3 rounded-xl text-sm transition-all flex items-center gap-2 font-semibold" :class="activeFilter === 'update' ? 'bg-chronext-gold text-chronext-dark' : 'glassmorphism-light hover:bg-chronext-gold/10'">
                    <i data-lucide="message-circle" class="w-4 h-4"></i>
                    Update (<span x-text="getTicketsByCategory('update').length"></span>)
                </button>
            </div>
        </div>

        <!-- Main Ticket Grid -->
        <div class="max-w-7xl mx-auto px-6 py-6 fade-in">
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <template x-for="ticket in filteredTickets" :key="ticket.id">
                    <div class="ticket-card glassmorphism rounded-2xl p-6" 
                         :class="{'pulse-warning border-l-4 border-chronext-rosegold': ticket.priority >= 6 && ticket.priority < 9, 'border-l-4 border-chronext-platinum/30': ticket.priority < 6}"
                         x-data="{expanded: false}"
                         :data-ticket-id="ticket.id">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="category-badge px-2 py-1 rounded uppercase font-semibold"
                                  :class="{
                                      'bg-chronext-crimson/20 text-chronext-crimson': ticket.category === 'legal',
                                      'bg-chronext-gold/20 text-chronext-gold': ticket.category === 'finance',
                                      'bg-blue-500/20 text-blue-400': ticket.category === 'logistics',
                                      'bg-chronext-platinum/20 text-chronext-platinum': ticket.category === 'update'
                                  }"
                                  x-text="ticket.category"></span>
                            <span class="category-badge px-2 py-1 rounded bg-chronext-anthracite text-chronext-platinum/60" x-text="'P' + ticket.priority"></span>
                        </div>

                        <h4 class="font-cinzel text-lg mb-2" x-text="ticket.clientName || 'Kunde'"></h4>
                        <p class="text-sm text-chronext-platinum/70 mb-3 line-clamp-2" x-text="ticket.problem"></p>

                        <div class="flex flex-wrap gap-2 mb-3">
                            <template x-for="link in ticket.links?.slice(0, 2)" :key="link">
                                <a :href="link" target="_blank" class="text-xs text-chronext-gold hover:underline flex items-center gap-1">
                                    <i data-lucide="external-link" class="w-3 h-3"></i>
                                    <span x-text="getLinkLabel(link)"></span>
                                </a>
                            </template>
                        </div>

                        <div x-show="expanded" x-collapse class="pt-3 border-t border-chronext-platinum/10">
                            <template x-if="ticket.context">
                                <p class="text-xs text-chronext-platinum/50 mb-2" x-text="ticket.context"></p>
                            </template>
                            <template x-if="ticket.phone">
                                <div class="flex items-center gap-2 mb-1 cursor-pointer hover:text-chronext-gold" @click="copyToClipboard(ticket.phone)">
                                    <i data-lucide="phone" class="w-3 h-3"></i>
                                    <span class="text-xs" x-text="ticket.phone"></span>
                                </div>
                            </template>
                        </div>

                        <div class="flex items-center justify-between mt-4 pt-4 border-t border-chronext-platinum/10">
                            <button @click="expanded = !expanded" class="text-xs text-chronext-platinum/50 hover:text-chronext-gold flex items-center gap-1">
                                <i data-lucide="chevron-down" class="w-4 h-4" :class="expanded ? 'rotate-180' : ''"></i>
                                <span x-text="expanded ? 'Weniger' : 'Mehr'"></span>
                            </button>
                            <div class="flex items-center gap-2">
                                <button @click="editTicket(ticket)" class="p-2 rounded hover:bg-chronext-platinum/10">
                                    <i data-lucide="edit-2" class="w-4 h-4"></i>
                                </button>
                                <button @click="dismissTicket(ticket.id, ticket.category)" class="magnetic-btn bg-green-500/20 text-green-400 rounded-lg px-4 py-2 text-sm font-semibold hover:bg-green-500/30">
                                    âœ“
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Empty State -->
            <template x-if="activeTickets.length === 0 && !showZeroInboxCelebration">
                <div class="text-center py-20">
                    <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-br from-chronext-gold to-chronext-rosegold flex items-center justify-center">
                        <i data-lucide="check-circle" class="w-12 h-12 text-chronext-dark"></i>
                    </div>
                    <h3 class="font-cinzel text-3xl mb-3 text-gradient-gold">Zero Inbox Achieved</h3>
                    <p class="text-chronext-platinum/60 text-lg italic">"Do better if possible, and that is always possible." â€” Vacheron Constantin</p>
                </div>
            </template>
        </div>

        <!-- Footer -->
        <footer class="max-w-7xl mx-auto px-6 py-12 text-center fade-in">
            <p class="text-sm text-chronext-platinum/40 italic font-cinzel" x-text="'\"' + footerQuote + '\"'"></p>
        </footer>
    </div>

    <!-- Good to Know Modal -->
    <div x-show="showGoodToKnow" x-cloak class="fixed inset-0 z-[200] flex items-center justify-center p-4" x-transition>
        <div class="absolute inset-0 bg-black/90" @click="showGoodToKnow = false"></div>
        <div class="relative glassmorphism rounded-2xl w-full max-w-lg p-8 good-to-know-popup" @click.stop>
            <div class="text-center">
                <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-chronext-gold to-chronext-rosegold flex items-center justify-center">
                    <i data-lucide="lightbulb" class="w-10 h-10 text-chronext-dark"></i>
                </div>
                <h3 class="font-cinzel text-2xl mb-4 text-gradient-gold">Good to Know</h3>
                <p class="text-sm text-chronext-platinum/90 leading-relaxed mb-6" x-text="currentGoodToKnow"></p>
                <button @click="showGoodToKnow = false" class="magnetic-btn bg-gradient-to-r from-chronext-gold to-chronext-rosegold text-chronext-dark rounded-lg px-8 py-3 font-semibold">
                    Verstanden
                </button>
            </div>
        </div>
    </div>

    <!-- Sisyphus Anger Popup -->
    <div x-show="showSisyphusAnger" x-cloak class="fixed bottom-32 right-8 z-[150] glassmorphism rounded-xl p-5 max-w-sm anger-shake" x-transition>
        <div class="flex items-start gap-3">
            <div class="text-4xl">ðŸ˜¤</div>
            <div>
                <p class="text-sm font-bold mb-1 text-chronext-gold">Sisyphus ist frustriert!</p>
                <p class="text-xs text-chronext-platinum/70" x-text="sisyphusAngerMessage"></p>
            </div>
        </div>
    </div>

    <!-- Input Modal -->
    <div x-show="showInputModal" x-cloak class="fixed inset-0 z-[100] flex items-center justify-center p-4" x-transition>
        <div class="absolute inset-0 bg-black/90" @click="showInputModal = false"></div>
        <div class="relative glassmorphism rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden" @click.stop>
            <div class="p-6 border-b border-chronext-platinum/10">
                <div class="flex items-center justify-between">
                    <h3 class="font-cinzel text-2xl text-gradient-gold">Intervention Parser</h3>
                    <button @click="showInputModal = false" class="p-2 rounded-lg hover:bg-chronext-platinum/10">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                <p class="text-xs text-chronext-platinum/50 mt-2">FÃ¼ge deinen Text ein â€” E-Mails, Slack-Nachrichten, Telefonnotizen</p>
            </div>

            <div class="p-6 overflow-y-auto max-h-[60vh]">
                <textarea x-model="rawInput" 
                          class="w-full h-64 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-xl p-4 text-sm text-chronext-platinum focus:border-chronext-gold focus:outline-none resize-none"
                          placeholder="Beispiel: Herr Pempelforth wird das heute Abend zum Anwalt geben..."></textarea>

                <div class="mt-4 flex items-center justify-between">
                    <div class="text-xs text-chronext-platinum/40">
                        <span x-text="rawInput.length"></span> Zeichen
                    </div>
                    <button @click="parseInput()" class="magnetic-btn bg-gradient-to-r from-chronext-gold to-chronext-rosegold text-chronext-dark rounded-lg px-6 py-3 font-semibold text-sm flex items-center gap-2">
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        Parse & Import
                    </button>
                </div>
            </div>

            <template x-if="parsedPreview.length > 0">
                <div class="p-6 border-t border-chronext-platinum/10 bg-chronext-dark/30">
                    <h4 class="text-sm font-semibold mb-3">Erkannte Tickets (<span x-text="parsedPreview.length"></span>)</h4>
                    <div class="space-y-2 max-h-40 overflow-y-auto scrollbar-hide">
                        <template x-for="(preview, idx) in parsedPreview" :key="idx">
                            <div class="glassmorphism-light rounded-lg p-3 text-xs">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="px-2 py-0.5 rounded text-[10px] uppercase font-semibold"
                                          :class="{
                                              'bg-chronext-crimson/20 text-chronext-crimson': preview.category === 'legal',
                                              'bg-chronext-gold/20 text-chronext-gold': preview.category === 'finance',
                                              'bg-blue-500/20 text-blue-400': preview.category === 'logistics',
                                              'bg-chronext-platinum/20 text-chronext-platinum': preview.category === 'update'
                                          }"
                                          x-text="preview.category"></span>
                                    <span class="font-semibold" x-text="preview.clientName || 'Kunde'"></span>
                                </div>
                                <p class="text-chronext-platinum/60 truncate" x-text="preview.problem"></p>
                            </div>
                        </template>
                    </div>
                    <button @click="confirmImport()" class="mt-4 w-full magnetic-btn bg-green-500/20 text-green-400 rounded-lg py-3 font-semibold text-sm hover:bg-green-500/30">
                        Alle Importieren
                    </button>
                </div>
            </template>
        </div>
    </div>

    <!-- Edit Modal -->
    <div x-show="showEditModal" x-cloak class="fixed inset-0 z-[100] flex items-center justify-center p-4" x-transition>
        <div class="absolute inset-0 bg-black/90" @click="showEditModal = false"></div>
        <div class="relative glassmorphism rounded-2xl w-full max-w-lg" @click.stop>
            <div class="p-6 border-b border-chronext-platinum/10">
                <h3 class="font-cinzel text-2xl text-gradient-gold">Ticket Bearbeiten</h3>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="text-xs text-chronext-platinum/60 uppercase tracking-wider font-semibold">Kundenname</label>
                    <input type="text" x-model="editingTicket.clientName" class="w-full mt-2 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-lg px-4 py-3 text-sm focus:border-chronext-gold focus:outline-none">
                </div>
                <div>
                    <label class="text-xs text-chronext-platinum/60 uppercase tracking-wider font-semibold">Problem</label>
                    <textarea x-model="editingTicket.problem" class="w-full mt-2 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-lg px-4 py-3 text-sm focus:border-chronext-gold focus:outline-none h-24 resize-none"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-chronext-platinum/60 uppercase tracking-wider font-semibold">Kategorie</label>
                        <select x-model="editingTicket.category" class="w-full mt-2 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-lg px-4 py-3 text-sm focus:border-chronext-gold focus:outline-none">
                            <option value="finance">Finance</option>
                            <option value="legal">Legal</option>
                            <option value="logistics">Logistics</option>
                            <option value="update">Update</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-xs text-chronext-platinum/60 uppercase tracking-wider font-semibold">PrioritÃ¤t (1-10)</label>
                        <input type="number" min="1" max="10" x-model="editingTicket.priority" class="w-full mt-2 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-lg px-4 py-3 text-sm focus:border-chronext-gold focus:outline-none">
                    </div>
                </div>
                <div>
                    <label class="text-xs text-chronext-platinum/60 uppercase tracking-wider font-semibold">Telefon</label>
                    <input type="text" x-model="editingTicket.phone" class="w-full mt-2 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-lg px-4 py-3 text-sm focus:border-chronext-gold focus:outline-none">
                </div>
                <div>
                    <label class="text-xs text-chronext-platinum/60 uppercase tracking-wider font-semibold">Kontext / Notizen</label>
                    <textarea x-model="editingTicket.context" class="w-full mt-2 bg-chronext-dark/50 border border-chronext-platinum/20 rounded-lg px-4 py-3 text-sm focus:border-chronext-gold focus:outline-none h-20 resize-none"></textarea>
                </div>
            </div>
            <div class="p-6 border-t border-chronext-platinum/10 flex justify-end gap-3">
                <button @click="showEditModal = false" class="px-5 py-3 rounded-lg text-sm hover:bg-chronext-platinum/10">Abbrechen</button>
                <button @click="saveEditedTicket()" class="magnetic-btn bg-gradient-to-r from-chronext-gold to-chronext-rosegold text-chronext-dark rounded-lg px-8 py-3 font-semibold text-sm">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Zero Inbox Celebration -->
    <div x-show="showZeroInboxCelebration" x-cloak class="fixed inset-0 z-[250] flex items-center justify-center" x-transition:enter="transition ease-out duration-1000" x-transition:enter-start="opacity-0" x-transition:enter-end="opacity-100">
        <div class="absolute inset-0 bg-chronext-dark/98"></div>
        <div class="relative text-center max-w-2xl mx-auto px-6">
            <div class="mb-8">
                <div class="w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-br from-chronext-gold to-chronext-rosegold flex items-center justify-center">
                    <i data-lucide="trophy" class="w-16 h-16 text-chronext-dark"></i>
                </div>
            </div>
            <h2 class="font-cinzel text-4xl md:text-5xl mb-6 text-gradient-gold">Sisyphus hat den Gipfel erreicht.</h2>
            <blockquote class="text-xl md:text-2xl italic text-chronext-platinum/90 mb-4" x-text="'\"' + celebrationWatch.quote + '\"'"></blockquote>
            <p class="text-base text-chronext-gold mb-8 font-cinzel" x-text="'â€” ' + celebrationWatch.brand"></p>
            <button @click="resetAfterCelebration()" class="magnetic-btn bg-gradient-to-r from-chronext-gold to-chronext-rosegold text-chronext-dark rounded-xl px-10 py-4 font-bold text-lg">
                ZurÃ¼ck zum Dashboard
            </button>
        </div>
    </div>

    <!-- Copy Toast -->
    <div x-show="showCopyToast" x-cloak class="fixed bottom-8 right-8 z-[300] glassmorphism rounded-xl px-5 py-3 flex items-center gap-3 copy-notification" x-transition>
        <i data-lucide="check" class="w-5 h-5 text-green-400"></i>
        <span class="text-sm font-semibold">Kopiert!</span>
    </div>

    <script>
        const HORLOGERIE_QUOTES = [
            { quote: "You never actually own a Patek Philippe. You merely look after it for the next generation.", brand: "Patek Philippe" },
            { quote: "Do better if possible, and that is always possible.", brand: "Vacheron Constantin" },
            { quote: "To break the rules, you must first master them.", brand: "Audemars Piguet" },
            { quote: "Never stand still.", brand: "A. Lange & SÃ¶hne" },
            { quote: "The watchmaker of watchmakers.", brand: "Jaeger-LeCoultre" },
            { quote: "Innovation is our tradition.", brand: "Breguet" },
            { quote: "Precision is not an act, but a habit.", brand: "Grand Seiko" }
        ];

        const GOOD_TO_KNOW_FACTS = [
            "Die Patek Philippe Grandmaster Chime Ref. 6300A wurde fÃ¼r 31 Millionen Dollar versteigert â€” die teuerste Armbanduhr der Welt.",
            "Eine mechanische Uhr besteht aus durchschnittlich 130 bis 300 Einzelteilen. Komplizierte Modelle kÃ¶nnen Ã¼ber 1.000 Teile haben.",
            "Der Begriff 'Chronometer' bezeichnet keine Uhr, sondern eine PrÃ¤zisionszertifizierung durch das COSC.",
            "Die kleinste mechanische Uhr der Welt ist die Jaeger-LeCoultre Calibre 101 â€” sie wiegt nur 1 Gramm.",
            "Rolex produziert jÃ¤hrlich etwa 1 Million Uhren, wÃ¤hrend Patek Philippe nur ca. 60.000 herstellt.",
            "Die erste Armbanduhr wurde 1868 von Patek Philippe fÃ¼r die GrÃ¤fin Koscowicz von Ungarn gefertigt.",
            "Ein Tourbillon wurde 1795 von Abraham-Louis Breguet erfunden, um die Schwerkraft-Effekte auf die Ganggenauigkeit zu kompensieren.",
            "Saphirglas, das bei Luxusuhren verwendet wird, hat eine HÃ¤rte von 9 auf der Mohs-Skala â€” nur Diamant ist hÃ¤rter.",
            "Die 'Perpetual Calendar' Komplikation berÃ¼cksichtigt automatisch unterschiedliche MonatslÃ¤ngen und Schaltjahre bis zum Jahr 2100."
        ];

        const CELEBRATION_WATCHES = [
            { quote: "You never actually own a Patek Philippe. You merely look after it for the next generation.", brand: "Patek Philippe" },
            { quote: "Never stand still.", brand: "A. Lange & SÃ¶hne" },
            { quote: "To break the rules, you must first master them.", brand: "Audemars Piguet" }
        ];

        const MOTIVATIONAL_QUOTES = [
            "Jedes Ticket ein Schritt nÃ¤her zum Gipfel.",
            "PrÃ¤zision in jeder Handlung.",
            "Der Berg wird kleiner mit jedem erledigten Fall.",
            "Excellence ist keine Handlung, sondern eine Gewohnheit.",
            "Sisyphus glaubt an dich.",
            "Wie ein Uhrwerk â€” konstant und prÃ¤zise.",
            "Der Gipfel ist in Sicht."
        ];

        const SISYPHUS_ANGER_MESSAGES = [
            "Immer noch hier? Ich dachte, wir machen Fortschritte!",
            "Der Stein wird nicht leichter, wenn du wartest...",
            "Meine Arme werden mÃ¼de. Vielleicht ein paar Tickets erledigen?",
            "Ich bin seit Stunden an der gleichen Stelle!",
            "Selbst Sisyphus braucht mal eine Pause... oder zumindest Fortschritt.",
            "WeiÃŸt du, wie schwer dieser Stein ist? Hilf mir mal!",
            "Ich glaube, der Berg wird hÃ¶her..."
        ];

        function interventionDashboard() {
            return {
                tickets: [],
                activeFilter: 'all',
                rawInput: '',
                parsedPreview: [],
                showInputModal: false,
                showEditModal: false,
                showZeroInboxCelebration: false,
                showCopyToast: false,
                showGoodToKnow: false,
                showSisyphusAnger: false,
                currentGoodToKnow: '',
                sisyphusAngerMessage: '',
                editingTicket: {},
                syncing: false,
                footerQuote: HORLOGERIE_QUOTES[Math.floor(Math.random() * HORLOGERIE_QUOTES.length)].quote,
                celebrationWatch: CELEBRATION_WATCHES[0],
                sisyphusProgress: 0,
                totalInitialTickets: 10,
                lastProgressCheck: Date.now(),

                get activeTickets() {
                    return this.tickets?.filter(t => !t?.dismissed) ?? [];
                },

                get criticalTickets() {
                    return this.activeTickets?.filter(t => (t?.priority ?? 0) >= 9) ?? [];
                },

                get filteredTickets() {
                    let filtered = this.activeTickets?.filter(t => (t?.priority ?? 0) < 9) ?? [];
                    if (this.activeFilter !== 'all') {
                        filtered = filtered?.filter(t => t?.category === this.activeFilter) ?? [];
                    }
                    return filtered?.sort((a, b) => (b?.priority ?? 0) - (a?.priority ?? 0)) ?? [];
                },

                async init() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const forceReset = urlParams.get('reset') === '1';

                    if (forceReset) {
                        localStorage.removeItem('chronext_tickets');
                        window.history.replaceState({}, '', window.location.pathname);
                    }

                    let stored = localStorage.getItem('chronext_tickets');
                    let needsDemo = !stored;

                    if (stored) {
                        try {
                            const parsed = JSON.parse(stored);
                            const activeCount = (parsed?.tickets ?? []).filter(t => !t?.dismissed).length;
                            needsDemo = activeCount === 0 && (parsed?.tickets?.length ?? 0) === 0;
                        } catch (e) {
                            needsDemo = true;
                        }
                    }

                    if (needsDemo || forceReset) {
                        const demoTickets = [
                            {
                                id: "demo1",
                                clientName: "Herr Pempelforth",
                                problem: "Wird das heute Abend zum Anwalt geben wenn keine RÃ¼ckmeldung kommt",
                                category: "legal",
                                priority: 10,
                                links: [],
                                phone: null,
                                context: "DRINGEND! Anwaltsdrohung fÃ¼r heute Abend",
                                timestamp: new Date().toISOString(),
                                dismissed: false
                            },
                            {
                                id: "demo2",
                                clientName: "Adrian Nieslony",
                                problem: "DHL hat sich nach 2 min aus dem Staub gemacht. Bitte Abholung neu terminieren",
                                category: "logistics",
                                priority: 7,
                                links: [],
                                phone: null,
                                context: "Hat schon mehrfach angerufen",
                                timestamp: new Date().toISOString(),
                                dismissed: false
                            },
                            {
                                id: "demo3",
                                clientName: "Herr Sommer",
                                problem: "MÃ¶chte eine Uhr verkaufen fÃ¼r einen Kunden der kein Internet benutzt",
                                category: "update",
                                priority: 5,
                                links: [],
                                phone: "+492681989056",
                                context: "Will nur kurz sprechen",
                                timestamp: new Date().toISOString(),
                                dismissed: false
                            },
                            {
                                id: "demo4",
                                clientName: "Kunde Finance",
                                problem: "Will klare Info warum Auszahlung lÃ¤nger dauert",
                                category: "finance",
                                priority: 8,
                                links: [],
                                phone: null,
                                context: "Braucht klare Kommunikation",
                                timestamp: new Date().toISOString(),
                                dismissed: false
                            }
                        ];
                        localStorage.setItem('chronext_tickets', JSON.stringify({ tickets: demoTickets }));
                        this.tickets = demoTickets;
                        this.totalInitialTickets = demoTickets.length;
                    } else {
                        await this.loadData();
                    }

                    if (this.tickets?.length === 0) {
                        await this.loadData();
                    }

                    this.updateSisyphusProgress();
                    this.initScrollAnimations();
                    this.initPhysicsEngine();
                    this.initIntersectionObserver();
                    lucide.createIcons();

                    this.$watch('activeTickets', (value) => {
                        this.updateSisyphusProgress();
                        if (valu
