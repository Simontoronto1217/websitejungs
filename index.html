<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CHRONEXT // SISYPHUS PROTOCOL</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Rajdhani:wght@300;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

    <script>
        // --- CONFIGURATION ---
        const CLOUD_CONFIG = {
            BIN_ID: '', // EINFÜGEN
            API_KEY: '' // EINFÜGEN
        };

        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'void': '#08080a',
                        'panel': 'rgba(20, 20, 25, 0.7)',
                        'gold': '#C5A059',
                        'gold-light': '#E6C275',
                        'alert': '#D62828',
                        'success': '#4ADE80',
                        'blue-ops': '#3B82F6'
                    },
                    fontFamily: {
                        'serif': ['Cinzel', 'serif'],
                        'tech': ['Rajdhani', 'sans-serif'],
                        'mono': ['Space Mono', 'monospace'],
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { margin: 0; overflow: hidden; background: #08080a; color: #E2E8F0; }
        
        /* SCIFI UI */
        .glass-hud {
            background: rgba(15, 15, 20, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }
        .glass-hud-strong {
            background: rgba(5, 5, 8, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(197, 160, 89, 0.2);
        }
        
        /* CATEGORY BADGES */
        .cat-badge { position: relative; overflow: hidden; }
        .cat-badge::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shine 3s infinite;
        }
        @keyframes shine { 100% { left: 200%; } }

        /* SCROLLBAR */
        .scroller::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        .scroller::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        .scroller::-webkit-scrollbar-thumb:hover { background: #C5A059; }

        /* INTRO */
        #splash { position: fixed; inset: 0; z-index: 100; background: #08080a; display: flex; align-items: center; justify-content: center; }
    </style>
</head>

<body x-data="sisyphus()" class="font-tech antialiased selection:bg-gold selection:text-black">

    <div id="webgl-stage" class="fixed inset-0 z-0 opacity-80 pointer-events-none"></div>

    <div id="splash">
        <div class="text-center">
            <h1 class="font-serif text-3xl text-gold tracking-[0.3em] mb-4" x-text="randomQuote"></h1>
            <div class="w-32 h-0.5 bg-gray-800 mx-auto overflow-hidden">
                <div id="load-bar" class="h-full bg-gold w-0"></div>
            </div>
        </div>
    </div>

    <main id="ui-layer" class="relative z-10 w-full h-screen flex flex-col opacity-0 p-6">
        
        <header class="flex justify-between items-start mb-6">
            <div class="flex items-center gap-6">
                <div>
                    <h1 class="font-serif text-4xl text-white tracking-widest">CHRONEXT</h1>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="w-2 h-2 rounded-full" :class="connectionStatus ? 'bg-success shadow-[0_0_10px_#4ADE80]' : 'bg-gray-600'"></div>
                        <span class="font-mono text-[10px] text-gray-400 tracking-[0.2em]">SISYPHUS_PROTOCOL_v9</span>
                    </div>
                </div>

                <div class="flex gap-4">
                    <div class="glass-hud px-4 py-2 rounded-sm border-l-2 border-gold">
                        <div class="text-[9px] font-mono text-gray-500 uppercase">Entropy Load</div>
                        <div class="text-xl font-bold text-gold" x-text="entropyLevel + '%'"></div>
                    </div>
                    <div class="glass-hud px-4 py-2 rounded-sm border-l-2 border-blue-ops">
                        <div class="text-[9px] font-mono text-gray-500 uppercase">Active Cases</div>
                        <div class="text-xl font-bold text-white" x-text="tickets.length"></div>
                    </div>
                </div>
            </div>

            <div class="flex gap-3">
                <button @click="openModal()" class="group relative overflow-hidden px-8 py-3 bg-gold/10 border border-gold/30 hover:border-gold transition-all">
                    <span class="relative z-10 font-serif font-bold text-xs tracking-widest text-gold group-hover:text-black transition-colors">+ INJECT INTEL</span>
                    <div class="absolute inset-0 bg-gold transform translate-y-full group-hover:translate-y-0 transition-transform duration-300"></div>
                </button>
                <button @click="syncData()" class="w-12 border border-white/10 flex items-center justify-center hover:bg-white/5 transition-colors">
                    <svg class="w-5 h-5 text-gray-400" :class="isLoading ? 'animate-spin text-gold' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                </button>
            </div>
        </header>

        <div class="flex-1 flex gap-6 overflow-hidden">
            
            <div class="w-1/3 flex flex-col gap-4">
                <div class="flex items-center justify-between border-b border-alert/30 pb-2">
                    <h2 class="font-serif text-alert tracking-widest text-sm flex items-center gap-2">
                        <span class="w-1.5 h-1.5 bg-alert rounded-full animate-pulse"></span> CRITICAL / LEGAL
                    </h2>
                    <span class="text-[10px] font-mono text-gray-500" x-text="getCriticalCount() + ' CASES'"></span>
                </div>
                
                <div class="flex-1 overflow-y-auto scroller space-y-3 pr-2">
                    <template x-for="ticket in getTicketsByCat('CRITICAL')" :key="ticket.id">
                        <div @click="editTicket(ticket)" class="glass-hud p-4 border-l-2 border-alert relative group hover:bg-alert/5 cursor-pointer transition-all hover:translate-x-1">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-serif font-bold text-lg text-alert" x-text="ticket.severity"></span>
                                <span class="text-[9px] font-mono border border-alert/30 text-alert px-1.5 rounded" x-text="ticket.action"></span>
                            </div>
                            <h3 class="font-bold text-white text-sm truncate" x-text="ticket.client"></h3>
                            <p class="text-[10px] text-gray-400 font-mono mt-1 line-clamp-2" x-text="ticket.context"></p>
                            
                            <div x-show="ticket.wait_time_alert" class="mt-2 flex items-center gap-2">
                                <span class="w-1 h-1 bg-alert rounded-full animate-ping"></span>
                                <span class="text-[9px] font-mono text-alert font-bold" x-text="ticket.wait_time_alert"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div class="w-1/3 flex flex-col gap-4">
                <div class="flex items-center justify-between border-b border-gold/30 pb-2">
                    <h2 class="font-serif text-gold tracking-widest text-sm">FINANCE & LOGISTICS</h2>
                    <span class="text-[10px] font-mono text-gray-500" x-text="getFinanceCount() + ' CASES'"></span>
                </div>

                <div class="flex-1 overflow-y-auto scroller space-y-3 pr-2">
                    <template x-for="ticket in getTicketsByCat('FINANCE')" :key="ticket.id">
                        <div @click="editTicket(ticket)" class="glass-hud p-4 border-l-2 border-gold relative group hover:bg-gold/5 cursor-pointer transition-all hover:translate-x-1">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-serif font-bold text-lg text-gold" x-text="ticket.severity"></span>
                                <span class="text-[9px] font-mono border border-gold/30 text-gold px-1.5 rounded" x-text="ticket.action"></span>
                            </div>
                            <h3 class="font-bold text-white text-sm truncate" x-text="ticket.client"></h3>
                            <div class="flex justify-between items-end mt-1">
                                <p class="text-[10px] text-gray-400 font-mono line-clamp-2 w-3/4" x-text="ticket.context"></p>
                                <span class="text-[10px] font-mono text-gray-600" x-text="ticket.ref_id"></span>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <div class="w-1/3 flex flex-col gap-4">
                <div class="flex items-center justify-between border-b border-blue-ops/30 pb-2">
                    <h2 class="font-serif text-blue-ops tracking-widest text-sm">CLIENT UPDATES</h2>
                    <span class="text-[10px] font-mono text-gray-500" x-text="getUpdateCount() + ' CASES'"></span>
                </div>

                <div class="flex-1 overflow-y-auto scroller space-y-3 pr-2">
                    <template x-for="ticket in getTicketsByCat('GENERAL')" :key="ticket.id">
                        <div @click="editTicket(ticket)" class="glass-hud p-4 border-l-2 border-blue-ops relative group hover:bg-blue-ops/5 cursor-pointer transition-all hover:translate-x-1">
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-serif font-bold text-lg text-blue-ops" x-text="ticket.severity"></span>
                                <span class="text-[9px] font-mono border border-blue-ops/30 text-blue-ops px-1.5 rounded" x-text="ticket.action"></span>
                            </div>
                            <h3 class="font-bold text-white text-sm truncate" x-text="ticket.client"></h3>
                            <p class="text-[10px] text-gray-400 font-mono mt-1 line-clamp-1" x-text="ticket.context"></p>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <div x-show="tickets.length === 0" class="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
            <div class="text-center">
                <h2 class="font-serif text-4xl text-gold animate-float mb-2">ASCENSION ACHIEVED</h2>
                <p class="font-mono text-xs text-gray-500 tracking-[0.5em]">"ONE MUST IMAGINE SISYPHUS HAPPY"</p>
            </div>
        </div>
    </main>

    <div x-show="showModal" x-transition.opacity.duration.300ms class="fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md">
        <div class="w-full max-w-5xl h-[85vh] glass-hud-strong flex shadow-2xl relative">
            
            <button @click="closeModal()" class="absolute top-4 right-4 text-gray-500 hover:text-white z-50">✕</button>

            <div class="w-1/2 p-8 border-r border-white/10 flex flex-col">
                <h2 class="font-serif text-xl text-gold mb-2" x-text="editMode ? 'MODIFY TICKET DATA' : 'RAW DATA INJECTION'"></h2>
                <p class="font-mono text-[10px] text-gray-500 mb-6">SISYPHUS PARSER ENGINE v9.0 ACTIVE</p>

                <template x-if="editMode">
                    <div class="space-y-4 flex-1 overflow-y-auto">
                        <div>
                            <label class="text-[9px] font-mono text-gold uppercase">Client Name</label>
                            <input x-model="editingTicket.client" class="w-full bg-white/5 border border-white/10 p-2 text-sm text-white focus:border-gold outline-none">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[9px] font-mono text-gold uppercase">Severity (1-10)</label>
                                <input type="number" x-model="editingTicket.severity" class="w-full bg-white/5 border border-white/10 p-2 text-sm text-gold font-bold focus:border-gold outline-none">
                            </div>
                             <div>
                                <label class="text-[9px] font-mono text-gold uppercase">Category</label>
                                <select x-model="editingTicket.category" class="w-full bg-white/5 border border-white/10 p-2 text-sm text-gray-300 focus:border-gold outline-none">
                                    <option value="CRITICAL">CRITICAL/LEGAL</option>
                                    <option value="FINANCE">FINANCE</option>
                                    <option value="LOGISTICS">LOGISTICS</option>
                                    <option value="GENERAL">GENERAL</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="text-[9px] font-mono text-gold uppercase">Context</label>
                            <textarea x-model="editingTicket.context" rows="4" class="w-full bg-white/5 border border-white/10 p-2 text-xs font-mono text-gray-300 focus:border-gold outline-none"></textarea>
                        </div>
                         <div>
                            <label class="text-[9px] font-mono text-gold uppercase">Action Required</label>
                            <input x-model="editingTicket.action" class="w-full bg-white/5 border border-white/10 p-2 text-sm text-white focus:border-gold outline-none">
                        </div>
                        <div>
                            <label class="text-[9px] font-mono text-gold uppercase">Links / Meta</label>
                            <input x-model="editingTicket.link" class="w-full bg-white/5 border border-white/10 p-2 text-xs text-blue-400 mb-2" placeholder="URL">
                            <input x-model="editingTicket.meta_copy" class="w-full bg-white/5 border border-white/10 p-2 text-xs text-gray-400" placeholder="IBAN / Phone">
                        </div>
                        
                        <div class="flex gap-4 pt-4">
                            <button @click="saveEdit()" class="flex-1 py-3 bg-gold text-black font-serif font-bold hover:bg-white transition-colors">SAVE CHANGES</button>
                            <button @click="archiveTicket(editingTicket.id)" class="px-6 py-3 border border-alert text-alert hover:bg-alert hover:text-white transition-colors">ARCHIVE</button>
                        </div>
                    </div>
                </template>

                <template x-if="!editMode">
                    <div class="flex flex-col h-full">
                        <textarea x-model="rawData" class="flex-1 bg-black/40 border border-white/10 p-4 font-mono text-xs text-gold resize-none outline-none focus:border-gold leading-relaxed mb-4" placeholder="Paste email block, call notes, or slack logs..."></textarea>
                        <button @click="processInput()" class="w-full py-4 bg-gold/10 border border-gold text-gold font-serif font-bold tracking-widest hover:bg-gold hover:text-black transition-all">
                            ANALYZE & GENERATE
                        </button>
                    </div>
                </template>
            </div>

            <div class="w-1/2 bg-[#050505] p-8 relative overflow-hidden flex flex-col">
                <div class="absolute top-0 right-0 w-64 h-64 bg-gold/5 rounded-full blur-3xl pointer-events-none"></div>
                
                <h3 class="font-serif text-xl text-white mb-6">PREVIEW DECK</h3>
                
                <template x-if="!editMode">
                    <div class="flex-1 overflow-y-auto scroller space-y-2">
                        <template x-for="(c, i) in detectedCases" :key="i">
                            <div class="p-3 border border-white/10 bg-white/5 flex gap-3 group relative">
                                <div class="w-8 flex flex-col items-center justify-center border-r border-white/10 pr-2">
                                    <span class="font-serif font-bold text-gold" x-text="c.severity"></span>
                                </div>
                                <div class="flex-1">
                                    <input x-model="c.client" class="bg-transparent text-white font-bold text-sm w-full outline-none">
                                    <div class="text-[10px] text-gray-500 truncate" x-text="c.context"></div>
                                    <div class="flex gap-2 mt-1">
                                        <span class="text-[9px] border border-white/10 px-1 text-gray-400" x-text="c.category"></span>
                                        <span x-show="c.wait_time_alert" class="text-[9px] text-alert animate-pulse" x-text="c.wait_time_alert"></span>
                                    </div>
                                </div>
                                <button @click="detectedCases.splice(i, 1)" class="text-gray-600 hover:text-alert opacity-0 group-hover:opacity-100">✕</button>
                            </div>
                        </template>
                        <div x-show="detectedCases.length === 0" class="h-full flex items-center justify-center text-gray-800 font-mono text-xs">
                            AWAITING INPUT...
                        </div>
                    </div>
                </template>

                 <template x-if="editMode">
                    <div class="flex-1 flex items-center justify-center text-center p-8 opacity-50">
                        <div>
                            <p class="font-serif text-2xl text-gold mb-2">"PRECISION IS THE SOUL OF LUXURY"</p>
                            <p class="font-mono text-xs text-gray-500">Updating records refines the workflow.</p>
                        </div>
                    </div>
                </template>

                <template x-if="!editMode && detectedCases.length > 0">
                    <button @click="confirmImport()" class="mt-4 w-full py-3 bg-white text-black font-serif font-bold hover:bg-gold transition-colors">
                        CONFIRM BATCH IMPORT
                    </button>
                </template>
            </div>
        </div>
    </div>

    <script>
        function sisyphus() {
            return {
                tickets: [],
                detectedCases: [],
                rawData: '',
                showModal: false,
                editMode: false,
                editingTicket: {},
                isLoading: false,
                
                // DATA
                quotes: [
                    "The struggle itself towards the heights is enough to fill a man's heart.",
                    "Time is the most valuable asset in luxury.",
                    "Precision in execution. Elegance in delivery.",
                    "Order is the foundation of excellence.",
                    "One must imagine Sisyphus happy."
                ],
                randomQuote: '',

                // COMPUTED
                get entropyLevel() { return Math.min(this.tickets.reduce((acc, t) => acc + t.severity, 0), 100); },
                get connectionStatus() { return CLOUD_CONFIG.BIN_ID && CLOUD_CONFIG.API_KEY; },

                async init() {
                    this.randomQuote = this.quotes[Math.floor(Math.random() * this.quotes.length)];
                    this.init3D();
                    
                    // Intro
                    const tl = gsap.timeline();
                    tl.to("#load-bar", { width: "100%", duration: 1.5, ease: "power2.inOut" })
                      .to("#splash", { opacity: 0, duration: 0.8, onComplete: () => document.getElementById('splash').remove() })
                      .to("#ui-layer", { opacity: 1, duration: 1 });

                    if(this.connectionStatus) await this.loadFromCloud();
                    else {
                        const local = localStorage.getItem('chronext_sisyphus_v9');
                        if(local) this.tickets = JSON.parse(local);
                    }
                },

                // --- 1. INTELLIGENCE ENGINE (Updated for Categories) ---
                processInput() {
                    this.detectedCases = [];
                    // Same robust splitting logic
                    let chunks = this.rawData.replace(/\n\s*\n/g, '|||').split('|||');
                    if(chunks.length < 2 && this.rawData.length > 150) chunks = this.rawData.split(/(?=https:\/\/|Bitte|SR\d|PO\d)/g);

                    chunks.forEach(chunk => {
                        if(chunk.length < 15) return;
                        
                        let severity = 5, action = "REVIEW", category = "GENERAL", waitAlert = null;

                        // Temporal Logic
                        const months = ['jan','feb','mär','apr','mai','jun','jul','aug','sep','okt','nov','dez'];
                        const mMatch = chunk.match(new RegExp(`(?:seit|vom|ab)\\s+(${months.join('|')})`, 'i'));
                        if(mMatch) {
                            const mIdx = months.findIndex(m => mMatch[1].toLowerCase().startsWith(m));
                            let diff = new Date().getMonth() - mIdx;
                            if(diff < 0) diff += 12;
                            
                            // IF WAITING > 2 MONTHS -> AUTO CRITICAL
                            if(diff >= 2) { 
                                severity = 10; 
                                waitAlert = `CRITICAL WAIT (${diff} MO)`; 
                                action = "DE-ESCALATE"; 
                                category = "CRITICAL";
                            } else if (diff >= 1) {
                                severity += 2;
                            }
                        }

                        // Category Logic
                        if(/anwalt|lawyer|polizei|betrug|deadline/i.test(chunk)) { severity = 10; category = "CRITICAL"; action = "LEGAL ALERT"; }
                        else if(/geld|iban|auszahlung|refund|invoice/i.test(chunk)) { severity += 1; category = "FINANCE"; action = "FINANCE CHECK"; }
                        else if(/dhl|versand|retoure|driver/i.test(chunk)) { severity += 1; category = "LOGISTICS"; action = "OPS CHECK"; }
                        else if(category === "GENERAL" && severity > 7) { category = "CRITICAL"; }

                        // Data Extraction
                        const link = (chunk.match(/https?:\/\/[^\s]+/) || [''])[0];
                        const ref = (chunk.match(/(SR\d+|PO\d+|#\d+)/i) || [''])[0].toUpperCase();
                        const meta = (chunk.match(/(\+49[\d\s]+|DE\d{20,})/) || [''])[0].replace(/\s/g,'');
                        let client = (chunk.match(/(?:Herr|Frau|Mr|Mrs)\.?\s+([A-ZÄÖÜ][a-zäöü]+(?:\s[A-ZÄÖÜ][a-zäöü]+)?)/) || [])[1] || (ref ? "Ref " + ref : "Unknown");

                        this.detectedCases.push({
                            id: Date.now() + Math.random(),
                            client, ref_id: ref, severity: Math.min(severity, 10),
                            category, action, link, meta_copy: meta, wait_time_alert: waitAlert,
                            context: chunk.replace(link,'').substring(0,140).trim() + "..."
                        });
                    });
                },

                // --- 2. TICKET MANAGEMENT ---
                getTicketsByCat(cat) {
                    // Logic to sort into swimlanes
                    if(cat === 'CRITICAL') return this.tickets.filter(t => t.category === 'CRITICAL' || t.severity >= 9).sort((a,b)=>b.severity-a.severity);
                    if(cat === 'FINANCE') return this.tickets.filter(t => (t.category === 'FINANCE' || t.category === 'LOGISTICS') && t.severity < 9).sort((a,b)=>b.severity-a.severity);
                    return this.tickets.filter(t => t.category === 'GENERAL' && t.severity < 9).sort((a,b)=>b.severity-a.severity);
                },

                // EDITING
                editTicket(ticket) {
                    // Deep copy to avoid reactive mess until save
                    this.editingTicket = JSON.parse(JSON.stringify(ticket));
                    this.editMode = true;
                    this.showModal = true;
                },
                
                async saveEdit() {
                    const idx = this.tickets.findIndex(t => t.id === this.editingTicket.id);
                    if(idx !== -1) {
                        this.tickets[idx] = this.editingTicket;
                        await this.saveToCloud();
                    }
                    this.closeModal();
                },

                async archiveTicket(id) {
                    this.tickets = this.tickets.filter(t => t.id !== id);
                    await this.saveToCloud();
                    this.closeModal();
                    // Visual Reward
                    this.triggerShockwave(); 
                },

                async confirmImport() {
                    this.tickets.unshift(...this.detectedCases);
                    this.detectedCases = [];
                    await this.saveToCloud();
                    this.closeModal();
                },

                // --- 3. CLOUD SYNC ---
                async loadFromCloud() {
                    this.isLoading = true;
                    try {
                        const res = await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_CONFIG.BIN_ID}/latest`, { headers: { 'X-Master-Key': CLOUD_CONFIG.API_KEY } });
                        const data = await res.json();
                        this.tickets = Array.isArray(data.record) ? data.record : [];
                    } catch(e) { console.error(e); }
                    this.isLoading = false;
                },
                async saveToCloud() {
                    if(!this.connectionStatus) { localStorage.setItem('chronext_sisyphus_v9', JSON.stringify(this.tickets)); return; }
                    this.isLoading = true;
                    await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_CONFIG.BIN_ID}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json', 'X-Master-Key': CLOUD_CONFIG.API_KEY },
                        body: JSON.stringify(this.tickets)
                    });
                    this.isLoading = false;
                },

                // UTILS
                openModal() { this.showModal = true; this.editMode = false; this.rawData = ''; this.detectedCases = []; },
                closeModal() { this.showModal = false; this.editMode = false; },
                getCriticalCount() { return this.getTicketsByCat('CRITICAL').length; },
                getFinanceCount() { return this.getTicketsByCat('FINANCE').length; },
                getUpdateCount() { return this.getTicketsByCat('GENERAL').length; },

                // --- 4. VISUALS (The Entropy Core) ---
                init3D() {
                    const container = document.getElementById('webgl-stage');
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
                    camera.position.z = 30;
                    
                    const renderer = new THREE.WebGLRenderer({alpha: true, antialias: true});
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    container.appendChild(renderer.domElement);

                    // THE CORE (Sisyphus Stone)
                    const geo = new THREE.IcosahedronGeometry(8, 2);
                    const mat = new THREE.MeshBasicMaterial({ color: 0x333333, wireframe: true, transparent: true, opacity: 0.1 });
                    this.core = new THREE.Mesh(geo, mat);
                    scene.add(this.core);

                    // Inner Glow
                    const innerGeo = new THREE.IcosahedronGeometry(6, 1);
                    const innerMat = new THREE.MeshBasicMaterial({ color: 0xC5A059, wireframe: false, transparent: true, opacity: 0.05 });
                    this.coreGlow = new THREE.Mesh(innerGeo, innerMat);
                    scene.add(this.coreGlow);

                    // Stars
                    const pGeo = new THREE.BufferGeometry();
                    const count = 1000;
                    const pos = new Float32Array(count*3);
                    for(let i=0; i<count*3; i++) pos[i] = (Math.random()-0.5)*100;
                    pGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                    const pMat = new THREE.PointsMaterial({size: 0.1, color: 0x555555});
                    this.stars = new THREE.Points(pGeo, pMat);
                    scene.add(this.stars);

                    const animate = () => {
                        requestAnimationFrame(animate);
                        
                        // Dynamic Rotation based on Stress
                        const stress = this.entropyLevel / 100;
                        const speed = 0.002 + (stress * 0.02);
                        
                        this.core.rotation.y += speed;
                        this.core.rotation.x += speed * 0.5;
                        this.stars.rotation.z -= 0.0005;

                        // Visual Feedback based on Stress
                        if(stress > 0.5) {
                            this.core.material.color.setHex(0xD62828); // Red
                            this.coreGlow.material.color.setHex(0xD62828);
                            this.coreGlow.scale.setScalar(1 + Math.sin(Date.now()*0.005)*0.2); // Pulse
                        } else if (stress === 0) {
                            this.core.material.color.setHex(0xC5A059); // Gold
                            this.coreGlow.material.color.setHex(0xC5A059);
                            this.core.position.y = Math.sin(Date.now()*0.001) * 2; // Float
                        } else {
                            this.core.material.color.setHex(0x333333); // Grey
                        }

                        renderer.render(scene, camera);
                    };
                    animate();
                },

                triggerShockwave() {
                    // Simple visual recoil when completing task
                    gsap.to(this.core.scale, { x: 0.8, y: 0.8, z: 0.8, duration: 0.1, yoyo: true, repeat: 1 });
                }
            }
        }
    </script>
</body>
</html>
